# Capa de validación de datos usando un middleware

La capa de validación es necesaria porque cuando estamos **consumiendo** nuestros **endpoints**, los endpoints no saben que datos le estamos enviando, si estamos enviando en el caso de una pelicula con titulo o sin titulo, o a la hora de recibir las peliculas el formato del id es correcto, entonces mediante este **middleware podemos validar o podemos especificar unos schemas**, de tal manera que podemos especificar que: la pelicula sea de tipo string, queremos que la numeración sea de tipo número, etc. De está manera si por alguna razón el cliente o el usuario ingrese los datos que no son, podemos especificar un error mostrando que partes son requeridas o que partes no tienen el formato, estó le va ha ayudar al cliente o al usuario a que se de cuenta como debe consumir nuestras API.

Para ello vamos a crear una funcionalidad que se va a llamar **validationHandler**, está funcionalidad va a **recibir** un **schema**, el esquema va a determinar cúal es el formato del esquema que vamos a enviar, **como segundo párametro** le vamos a informar **donde queremos checar este esquema**, por defecto vamos a checar el **body del request**, pero también podríamos checar los párametros o el query, etc. Cuando tenemos estos datos en la función retornamos una función que tiene la firma de un middleware, cogemos una utilidad que vamos a llamar validate, en esté caso le vamos a pasar en el req **[check]** checando el body, y le vamos a pasar un schema y esto puede que devuelva o no un error de validación, si devuelve un error, lo que vamos a hacer es llamar a nuestra funcionalidad next con el error.

Acuerdence que cuando llamos a nuestra funcionalidad **next** con un párametro, en esté caso el error, van a empezar a ejecutarse los middlewares de error, si no simplemente llamos a nuestra funcionalidad next y **como no le estamos pasando ningun párametro va a llamar al siguiente middleware**.

![[Pasted image 20210904190046.png]]